<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tracing ELI5 &#8212; BEAM VM Wisdoms</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="BIF and NIF functions ELI5" href="eli5-bif-nif.html" />
    <link rel="prev" title="Input/Output and Ports ELI5" href="eli5-io.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
<section id="tracing-eli5">
<h1>Tracing ELI5<a class="headerlink" href="#tracing-eli5" title="Permalink to this heading">¶</a></h1>
<p>How does Erlang VM perform tracing of calls, messages, processes spawning and
passing away?</p>
<p>Tracing is a VM mode, that can be toggled on and off, and starts producing a
stream of events.
A call to <code class="docutils literal notranslate"><span class="pre">dbg:tracer()</span></code> starts a process which will receive this stream.
You can create your own tracer with its own state and feed events to it.</p>
<p>Tracing is able to produce overwhelming amount of irrelevant data.
To limit this data a trace filter is applied with <code class="docutils literal notranslate"><span class="pre">dbg:tp/4</span></code> (and similar).</p>
<p>When everything is prepared: a tracer and a filter, it is time to open the
valve. A call to <code class="docutils literal notranslate"><span class="pre">dbg:p/2</span></code> (and similar) sets the trace target (a process,
a port, spawn and exit events, everything, and so on).
It will start sending everything that matches trace target and the filter
you’ve set to the tracer process.</p>
<section id="inner-workings-of-the-tracing">
<h2>Inner Workings of the Tracing<a class="headerlink" href="#inner-workings-of-the-tracing" title="Permalink to this heading">¶</a></h2>
<p>Simple things, like process lifetime events or messages have tracer checks
in place everywhere in the virtual machine’s C code. If tracing is enabled,
then a message is sent to the current tracer.</p>
<p>Tracing calls and returns from BIF functions is a bit more complex. Because BIF
are not real Erlang code, they have to be wrapped in a tracing code somehow.
This is done by replacing BIF table with BIF entry function addresses with
another table.
Each entry in this new table is a simple call to <code class="docutils literal notranslate"><span class="pre">erts_bif_trace</span></code> with a
function name and arguments.
This function performs the real call and sends trace messages.</p>
<p>At certain moments, when we want to trace a BIF trapping and returning to
execution later, another trick is used.
Address to a special BEAM opcode is pushed onto the stack before the BIF is
finished. This allows to catch up when trap continues execution and will send
the trace event correctly when the BIF was finished.</p>
</section>
</section>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-84125230-1', 'auto');
ga('send', 'pageview');
</script>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div style="margin-bottom:16px;">
    <a href="http://beam-wisdoms.clau.se/" alt="Wisdoms Home Page"
    title="Return to the Home Page"><img src="_static/img/bw_logo.png" width="200"></a>
</div>


<h1 class="logo"><a href="index.html">BEAM VM Wisdoms</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="eli5-vm.html">BEAM VM ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-atoms.html">Atoms ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-processes.html">Processes ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-process-heap.html">Process Heaps ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-io.html">Input/Output and Ports ELI5</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tracing ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-bif-nif.html">BIF and NIF functions ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-types.html">Types ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-etf.html">External Term Format ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-property-based.html">Property Based Testing ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-efficiency.html">Efficiency ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-efficiency-memory-perf.html">Memory Performance ELI5</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="definitions.html">BEAM Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="indepth-memory-layout.html">Data Types Memory Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="indepth-data-sizes.html">BEAM Internal data sizes</a></li>
<li class="toctree-l1"><a class="reference internal" href="indepth-heap-layout.html">Process Heap Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfacing.html">Interfacing Erlang with the Outer World</a></li>
<li class="toctree-l1"><a class="reference internal" href="indepth-beam-file.html">BEAM File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="indepth-beam-instructions.html">BEAM Instruction Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="indepth-io.html">IO in Erlang</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="eli5-io.html" title="previous chapter">Input/Output and Ports ELI5</a></li>
      <li>Next: <a href="eli5-bif-nif.html" title="next chapter">BIF and NIF functions ELI5</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-2017, Dmytro "kvakvs" Lytovchenko.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/eli5-tracing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>