<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>BEAM Internal data sizes &#8212; BEAM VM Wisdoms</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Process Heap Layout" href="indepth-heap-layout.html" />
    <link rel="prev" title="Data Types Memory Layout" href="indepth-memory-layout.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
<section id="beam-internal-data-sizes">
<h1>BEAM Internal data sizes<a class="headerlink" href="#beam-internal-data-sizes" title="Permalink to this heading">¶</a></h1>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Data sizes in the
<cite>Erlang Efficiency Guide &lt;http://erlang.org/doc/efficiency_guide/advanced.html&gt;</cite></p>
</div>
<p>Each boxed term has size described below plus one word for term value
itself which you store somewhere else (be it on heap then you should count size
for this term too, or in register/on stack - then it will not consume heap
memory).</p>
<p>For specific bit positions and bit sizes please always refer to original beam
sources, file: <code class="docutils literal notranslate"><span class="pre">erl_term.h</span></code></p>
<section id="immediate">
<h2>Immediate<a class="headerlink" href="#immediate" title="Permalink to this heading">¶</a></h2>
<p>All immediate values have size of one <a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Word</span></a>.</p>
<p>They are: local <strong>pid</strong>, local <strong>port</strong>, <strong>small integer</strong>, <strong>atom</strong>, <strong>NIL</strong>
(an empty list <code class="docutils literal notranslate"><span class="pre">[]</span></code>) and catch (internal value). <a class="reference internal" href="definitions.html#def-cp"><span class="std std-ref">CP</span></a> can
also be considered an immediate although it is a special value which only
appears on stack and never in registers or heap.</p>
</section>
<section id="list">
<h2>List<a class="headerlink" href="#list" title="Permalink to this heading">¶</a></h2>
<p>List value is a pointer to cons cell. Cons cell has size of two
<a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Words</span></a> (one for head, and another for tail). Cons cell can
link to next cons cell and so on, until tail becomes a non-list term (for improper
lists) or <code class="docutils literal notranslate"><span class="pre">NIL</span></code> (for proper lists).</p>
<p>Size of a list is 1 <a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Word</span></a> (for a pointer) and also on the heap
<code class="docutils literal notranslate"><span class="pre">2*num_cells</span></code> <a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Words</span></a>.</p>
</section>
<section id="boxed">
<h2>Boxed<a class="headerlink" href="#boxed" title="Permalink to this heading">¶</a></h2>
<p>Boxed value is a pointer to the heap or some other area and always takes 1
<a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Words</span></a>.
A Box always points to a memory block which starts with a Header (below)
except during GC.</p>
</section>
<section id="header">
<h2>Header<a class="headerlink" href="#header" title="Permalink to this heading">¶</a></h2>
<p>A Box always points to a Header except during GC.
Header word typically contains an <cite>arity</cite>, which is stored in most-significant
bits of their first word, following the header tag (which is 4+2 bits).</p>
<p>Header is a special tag which hides all sorts of internal opaque data. Header
can be found on heap only and remaining most-significant bits usually represent
its size (arity). For maps, arity is calculated using different formula (see
<code class="docutils literal notranslate"><span class="pre">MAP_HEADER_ARITY</span></code> macro).</p>
<p>By header tag headers can mark the beginning of:
arityval (a <strong>tuple</strong>),
<strong>fun</strong> (closure with frozen variable values),
positive and negative <strong>bigint</strong> (tagged separately to avoid storing sign bit),
<strong>float</strong>, <strong>export</strong>, <strong>refvalue</strong>, <strong>refcounted binary</strong>, <strong>heap binary</strong>,
<strong>subbinary</strong>, external <strong>pid</strong>, <strong>port</strong>, <strong>ref</strong>,
<strong>matchstate</strong> (internal object) and <strong>map</strong>.</p>
<section id="tuple">
<h3>Tuple<a class="headerlink" href="#tuple" title="Permalink to this heading">¶</a></h3>
<p>Tuple size on heap is its arity plus 1 <a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Word</span></a> header.
Also 1 <a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Word</span></a> to store each pointer to the tuple box.</p>
</section>
<section id="float">
<h3>Float<a class="headerlink" href="#float" title="Permalink to this heading">¶</a></h3>
<p>Float size is always 64 bit (1 or 2 words) + 1 <a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Word</span></a> header.
Also 1 <a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Word</span></a> to store each pointer to the float box.</p>
</section>
<section id="big-integer">
<h3>Big Integer<a class="headerlink" href="#big-integer" title="Permalink to this heading">¶</a></h3>
<p>Bigint size is <code class="docutils literal notranslate"><span class="pre">ceil(log2^64(Number))</span></code> <a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Words</span></a>
+ 1 <a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Word</span></a> header.
Thus a &lt;=64bit integer will take 1 word,65-127bit will take 2 words and so on.
On 32-bit architectures, of course, the Word size is 32 bit and everything is
32-bit based.
Also +1 <a class="reference internal" href="definitions.html#def-word"><span class="std std-ref">Word</span></a> to store each pointer to the bigint box.</p>
</section>
</section>
</section>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-84125230-1', 'auto');
ga('send', 'pageview');
</script>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div style="margin-bottom:16px;">
    <a href="http://beam-wisdoms.clau.se/" alt="Wisdoms Home Page"
    title="Return to the Home Page"><img src="_static/img/bw_logo.png" width="200"></a>
</div>


<h1 class="logo"><a href="index.html">BEAM VM Wisdoms</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="eli5-vm.html">BEAM VM ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-atoms.html">Atoms ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-processes.html">Processes ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-process-heap.html">Process Heaps ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-io.html">Input/Output and Ports ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-tracing.html">Tracing ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-bif-nif.html">BIF and NIF functions ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-types.html">Types ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-etf.html">External Term Format ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-property-based.html">Property Based Testing ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-efficiency.html">Efficiency ELI5</a></li>
<li class="toctree-l1"><a class="reference internal" href="eli5-efficiency-memory-perf.html">Memory Performance ELI5</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="definitions.html">BEAM Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="indepth-memory-layout.html">Data Types Memory Layout</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">BEAM Internal data sizes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#immediate">Immediate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list">List</a></li>
<li class="toctree-l2"><a class="reference internal" href="#boxed">Boxed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#header">Header</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="indepth-heap-layout.html">Process Heap Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfacing.html">Interfacing Erlang with the Outer World</a></li>
<li class="toctree-l1"><a class="reference internal" href="indepth-beam-file.html">BEAM File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="indepth-beam-instructions.html">BEAM Instruction Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="indepth-io.html">IO in Erlang</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="indepth-memory-layout.html" title="previous chapter">Data Types Memory Layout</a></li>
      <li>Next: <a href="indepth-heap-layout.html" title="next chapter">Process Heap Layout</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-2017, Dmytro "kvakvs" Lytovchenko.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/indepth-data-sizes.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>